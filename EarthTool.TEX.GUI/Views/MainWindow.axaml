<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:EarthTool.TEX.GUI.ViewModels"
        xmlns:converters="using:EarthTool.TEX.GUI.Converters"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="EarthTool.TEX.GUI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/ucs-logo.ico"
        Title="EarthTool.TEX.GUI">

  <Window.Resources>
    <converters:FileNameConverter x:Key="FileNameConverter" />
  </Window.Resources>

  <Design.DataContext>
    <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
    <vm:MainWindowViewModel />
  </Design.DataContext>

  <DockPanel>
    <!-- Menu Bar -->
    <Menu DockPanel.Dock="Top">
      <MenuItem Header="_File">
        <MenuItem Header="_Open File..." Command="{Binding OpenFileCommand}" HotKey="Ctrl+O" />
        <MenuItem Header="Open _Folder..." Command="{Binding OpenFolderCommand}" HotKey="Ctrl+Shift+O" />
      </MenuItem>

      <MenuItem Header="_Help">
        <MenuItem Header="_About" Command="{Binding ShowAboutCommand}" />
      </MenuItem>
    </Menu>

    <!-- Toolbar -->
    <Border DockPanel.Dock="Top"
            BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
            BorderThickness="0,0,0,1"
            Padding="8,4">
      <StackPanel Orientation="Horizontal" Spacing="8">
        <Button Command="{Binding OpenFileCommand}" ToolTip.Tip="Open File (Ctrl+O)">
          <TextBlock Text="ðŸ“‚" FontSize="{StaticResource FontSize.Icon}" />
        </Button>
        <Button Command="{Binding OpenFolderCommand}" ToolTip.Tip="Open Folder (Ctrl+Shift+O)">
          <TextBlock Text="ðŸ“" FontSize="{StaticResource FontSize.Icon}" />
        </Button>
        <Separator />
        <Button Command="{Binding PreviousFileCommand}" ToolTip.Tip="Previous File">
          <TextBlock Text="â—€" FontSize="{StaticResource FontSize.Icon}" />
        </Button>
        <TextBlock VerticalAlignment="Center" Text="{Binding CurrentFileName}" FontWeight="Bold" />
        <Button Command="{Binding NextFileCommand}" ToolTip.Tip="Next File">
          <TextBlock Text="â–¶" FontSize="{StaticResource FontSize.Icon}" />
        </Button>
      </StackPanel>
    </Border>

    <!-- Status Bar -->
    <Border DockPanel.Dock="Bottom"
            Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
            BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
            BorderThickness="0,1,0,0"
            Padding="8,4">
      <Grid ColumnDefinitions="*,Auto">
        <TextBlock Grid.Column="0"
                   Text="{Binding CurrentFilePath}"
                   VerticalAlignment="Center" />
        <TextBlock Grid.Column="1"
                   VerticalAlignment="Center"
                   Margin="8,0,0,0">
          <Run Text="Images: " />
          <Run Text="{Binding Images.Count}" />
        </TextBlock>
      </Grid>
    </Border>

    <!-- Main Content Area -->
    <Grid ColumnDefinitions="200,200,*">
      <!-- Left Panel - File List -->
      <Border Grid.Column="0"
              BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
              BorderThickness="0,0,1,0"
              Padding="4">
        <DockPanel>
          <!-- Header Info Panel -->
          <Expander DockPanel.Dock="Top"
                    Header="File Header"
                    IsExpanded="True"
                    Margin="4"
                    HorizontalAlignment="Stretch">
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                    BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                    BorderThickness="1"
                    Padding="8"
                    Margin="4">
              <ScrollViewer MaxHeight="300"
                            VerticalScrollBarVisibility="Auto">
                <TextBlock Text="{Binding HeaderInfo}"
                           FontFamily="Consolas,Courier New,monospace"
                           FontSize="11"
                           TextWrapping="Wrap" />
              </ScrollViewer>
            </Border>
          </Expander>
          <TextBlock DockPanel.Dock="Top"
                     Text="Files"
                     FontWeight="Bold"
                     Margin="4,4,4,8" />
          <TextBlock DockPanel.Dock="Top"
                     Text="{Binding CurrentFolderPath}"
                     FontSize="10"
                     Foreground="Gray"
                     Margin="4,0,4,8"
                     TextWrapping="Wrap" />
          <ListBox ItemsSource="{Binding TexFiles}"
                   SelectedIndex="{Binding CurrentFileIndex}">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <TextBlock Text="{Binding Converter={StaticResource FileNameConverter}}" />
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
        </DockPanel>
      </Border>

      <!-- Middle Panel - Image List -->
      <Border Grid.Column="1"
              BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
              BorderThickness="0,0,1,0"
              Padding="4">
        <DockPanel>
          <!-- Selected Image Header Info -->
          <Expander DockPanel.Dock="Top"
                    Header="Image Header"
                    IsExpanded="True"
                    Margin="4"
                    HorizontalAlignment="Stretch">
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                    BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                    BorderThickness="1"
                    Padding="8"
                    Margin="4">
              <ScrollViewer MaxHeight="250"
                            VerticalScrollBarVisibility="Auto">
                <TextBlock Text="{Binding SelectedImageHeaderInfo}"
                           FontFamily="Consolas,Courier New,monospace"
                           FontSize="10"
                           TextWrapping="Wrap" />
              </ScrollViewer>
            </Border>
          </Expander>
          <TextBlock DockPanel.Dock="Top"
                     Text="Images"
                     FontWeight="Bold"
                     Margin="4,4,4,8" />
          <ListBox ItemsSource="{Binding Images}"
                   SelectedIndex="{Binding SelectedImageIndex}"
                   Margin="0,0,0,4">
            <ListBox.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Image Source="{Binding}"
                         Width="64"
                         Height="64"
                         Stretch="Uniform" />
                  <TextBlock Text="{Binding PixelSize}"
                             VerticalAlignment="Center" />
                </StackPanel>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
        </DockPanel>
      </Border>

      <!-- Right Panel - Image Viewer -->
      <Border Grid.Column="2"
              Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
              Padding="8">
        <Viewbox Stretch="Uniform">
          <Image Source="{Binding SelectedImage}"
                 RenderOptions.BitmapInterpolationMode="HighQuality" />
        </Viewbox>
      </Border>
    </Grid>
  </DockPanel>
</Window>
